#include <stdio.h>
#include <stdint.h>
#include <wiringPi.h>

// read SPI data from MCP3008 chip, 8 possible adc's (0 thru 7)
int readadc(chan,adcnum)
{
 uint8_t buff[3];
 int adc;
 if ((adcnum > 7) || (adcnum < 0))
  return -1;
 buff[0] = 1;
 buff[1] = (8+adcnum)<<4;
 buff[2] = 0;
 wiringPiSPIDataRW(chan, buff, 3);
 adc = ((buff[1]&3) << 8) + buff[2];
 return adc;
}

int main(void)
{
  int i, chan, clk;
  uint32_t x1, tot;
  int outs[16];
  clk = 1000000;
  // Set up SPI ports
  if (wiringPiSPISetup (0, clk) < 0)
    return -1 ;
  if (wiringPiSPISetup (1, clk) < 0)
    return -1 ;
 // run until killed with Ctrl-C
  for(chan=0;chan<=1;chan++) {
    for(i=0;i<=7;i++) {
      printf("%d ", readadc(chan,i));
    }
  }
  printf("\n");
 return 0;
}
